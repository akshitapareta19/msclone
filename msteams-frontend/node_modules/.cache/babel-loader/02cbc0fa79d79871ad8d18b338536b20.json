{"ast":null,"code":"import * as wss from '../wssConnection/wssConnection';\nimport store from '../../store/store';\nimport { setGroupCallActive, setCallState, callStates, setGroupCallIncomingStreams, clearGroupCallData } from '../../store/actions/callActions';\nlet myPeer;\nlet myPeerId;\nlet groupCallRoomId;\nexport const connectWithMyPeer = () => {\n  myPeer = new window.Peer(undefined, {\n    path: '/peerjs',\n    host: '/',\n    port: '5000'\n  });\n  myPeer.on('open', id => {\n    console.log('succesfully connected with peer server');\n    myPeerId = id;\n  });\n  myPeer.on('call', call => {\n    call.answer(store.getState().call.localStream);\n    call.on('stream', incomingStream => {\n      const streams = store.getState().call.groupCallStreams;\n      const stream = streams.find(stream => stream.id === incomingStream.id);\n\n      if (!stream) {\n        addVideoStream(incomingStream);\n      }\n    });\n  });\n};\nexport const createNewGroupCall = () => {\n  wss.registerGroupCall({\n    username: store.getState().dashboard.username,\n    peerId: myPeerId\n  });\n  store.dispatch(setGroupCallActive(true));\n  store.dispatch(setCallState(callStates.CALL_IN_PROGRESS));\n};\nexport const joinGroupCall = (hostSocketId, roomId) => {\n  const localStream = store.getState().call.localStream;\n  groupCallRoomId = roomId;\n  wss.userWantsToJoinGroupCall({\n    peerId: myPeerId,\n    hostSocketId,\n    roomId,\n    localStreamId: localStream.id\n  });\n  store.dispatch(setGroupCallActive(true));\n  store.dispatch(setCallState(callStates.CALL_IN_PROGRESS));\n};\nexport const connectToNewUser = data => {\n  const localStream = store.getState().call.localStream;\n  const call = myPeer.call(data.peerId, localStream);\n  call.on('stream', incomingStream => {\n    const streams = store.getState().call.groupCallStreams;\n    const stream = streams.find(stream => stream.id === incomingStream.id);\n\n    if (!stream) {\n      addVideoStream(incomingStream);\n    }\n  });\n};\nexport const leaveGroupCall = () => {\n  wss.userLeftGroupCall({\n    streamId: store.getState().call.localStream.id,\n    roomId: groupCallRoomId\n  });\n  groupCallRoomId = null;\n  store.dispatch(clearGroupCallData());\n  myPeer.destroy();\n  connectWithMyPeer();\n};\nexport const removeInactiveStream = data => {\n  const groupCallStreams = store.getState().call.groupCallStreams.filter(stream => stream.id !== data.streamId);\n  store.dispatch(setGroupCallIncomingStreams(groupCallStreams));\n};\n\nconst addVideoStream = incomingStream => {\n  const groupCallStreams = [...store.getState().call.groupCallStreams, incomingStream];\n  store.dispatch(setGroupCallIncomingStreams(groupCallStreams));\n};","map":{"version":3,"sources":["C:/Users/akshi/OneDrive/Documents/Desktop/msteams/msteams-frontend/src/utils/webRTC/webRTCGroupCallHandler.js"],"names":["wss","store","setGroupCallActive","setCallState","callStates","setGroupCallIncomingStreams","clearGroupCallData","myPeer","myPeerId","groupCallRoomId","connectWithMyPeer","window","Peer","undefined","path","host","port","on","id","console","log","call","answer","getState","localStream","incomingStream","streams","groupCallStreams","stream","find","addVideoStream","createNewGroupCall","registerGroupCall","username","dashboard","peerId","dispatch","CALL_IN_PROGRESS","joinGroupCall","hostSocketId","roomId","userWantsToJoinGroupCall","localStreamId","connectToNewUser","data","leaveGroupCall","userLeftGroupCall","streamId","destroy","removeInactiveStream","filter"],"mappings":"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","sourcesContent":["import * as wss from '../wssConnection/wssConnection';\r\nimport store from '../../store/store';\r\nimport { setGroupCallActive, setCallState, callStates, setGroupCallIncomingStreams, clearGroupCallData } from '../../store/actions/callActions';\r\n\r\nlet myPeer;\r\nlet myPeerId;\r\nlet groupCallRoomId;\r\n\r\nexport const connectWithMyPeer = () => {\r\n  myPeer = new window.Peer(undefined, {\r\n    path: '/peerjs',\r\n    host: '/',\r\n    port: '5000'\r\n  });\r\n\r\n  myPeer.on('open', (id) => {\r\n    console.log('succesfully connected with peer server');\r\n    myPeerId = id;\r\n  });\r\n\r\n  myPeer.on('call', call => {\r\n    call.answer(store.getState().call.localStream);\r\n    call.on('stream', incomingStream => {\r\n      const streams = store.getState().call.groupCallStreams;\r\n      const stream = streams.find(stream => stream.id === incomingStream.id);\r\n\r\n      if (!stream) {\r\n        addVideoStream(incomingStream);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const createNewGroupCall = () => {\r\n  wss.registerGroupCall({\r\n    username: store.getState().dashboard.username,\r\n    peerId: myPeerId\r\n  });\r\n\r\n  store.dispatch(setGroupCallActive(true));\r\n  store.dispatch(setCallState(callStates.CALL_IN_PROGRESS));\r\n}\r\n;\r\n\r\nexport const joinGroupCall = (hostSocketId, roomId) => {\r\n  const localStream = store.getState().call.localStream;\r\n  groupCallRoomId = roomId;\r\n\r\n  wss.userWantsToJoinGroupCall({\r\n    peerId: myPeerId,\r\n    hostSocketId,\r\n    roomId,\r\n    localStreamId: localStream.id\r\n  });\r\n\r\n  store.dispatch(setGroupCallActive(true));\r\n  store.dispatch(setCallState(callStates.CALL_IN_PROGRESS));\r\n};\r\n\r\nexport const connectToNewUser = (data) => {\r\n  const localStream = store.getState().call.localStream;\r\n\r\n  const call = myPeer.call(data.peerId, localStream);\r\n\r\n  call.on('stream', (incomingStream) => {\r\n    const streams = store.getState().call.groupCallStreams;\r\n    const stream = streams.find(stream => stream.id === incomingStream.id);\r\n\r\n    if (!stream) {\r\n      addVideoStream(incomingStream);\r\n    }\r\n  });\r\n};\r\n\r\nexport const leaveGroupCall = () => {\r\n  wss.userLeftGroupCall({\r\n    streamId: store.getState().call.localStream.id,\r\n    roomId: groupCallRoomId\r\n  });\r\n\r\n  groupCallRoomId = null;\r\n  store.dispatch(clearGroupCallData());\r\n  myPeer.destroy();\r\n  connectWithMyPeer();\r\n};\r\n\r\nexport const removeInactiveStream = (data) => {\r\n  const groupCallStreams = store.getState().call.groupCallStreams.filter(\r\n    stream => stream.id !== data.streamId\r\n  );\r\n  store.dispatch(setGroupCallIncomingStreams(groupCallStreams));\r\n};\r\n\r\nconst addVideoStream = (incomingStream) => {\r\n  const groupCallStreams = [\r\n    ...store.getState().call.groupCallStreams,\r\n    incomingStream\r\n  ];\r\n\r\n  store.dispatch(setGroupCallIncomingStreams(groupCallStreams));\r\n};\r\n"]},"metadata":{},"sourceType":"module"}